import{n as fe,f as he,a as _e}from"../chunks/Dj2A1cQj.js";import{s as me,n as z,d,i as j,m as pe,g as M,u as le,j as N,k as ae,p as ve,v as be,l as u,c as m,o as Q,h as p,w as ge,a as O,x as re,b as c,q as R,y as ye,e as y,f as x,t as F}from"../chunks/B7P-bQO9.js";import{e as ie,u as ke,d as Ie}from"../chunks/C3bkP_Kp.js";import{S as Ee,i as Se}from"../chunks/BuTC0y2q.js";import{g as G}from"../chunks/3iu1C0Kx.js";import{p as De}from"../chunks/D30foP-V.js";import{b as J}from"../chunks/DkN-uFVr.js";import{n as Ce,c as Te}from"../chunks/BN_xWD1A.js";import{a as Ve}from"../chunks/CshrlUFe.js";const we=!1,Me=async({params:a})=>{if(!localStorage.getItem("fairfield_auth"))return{channel:null,messages:[]};try{const e=fe.get();if(!e)return{channel:null,messages:[]};const r=(await he(e)).find(n=>n.id===a.channelId);if(!r)return{channel:null,messages:[]};const o=await _e(e,a.channelId);return{channel:r,messages:o}}catch(e){return console.error("Failed to load channel:",e),{channel:null,messages:[]}}},Ge=Object.freeze(Object.defineProperty({__proto__:null,load:Me,prerender:we},Symbol.toStringTag,{value:"Module"}));function oe(a,t,e){const s=a.slice();return s[13]=t[e],s}function Ne(a){let t,e,s,r,o="‚Üê Back to Channels",n,l,i=a[0].name+"",E,S,g,h,D,V,w,_,I,k,K,T,L=a[4]?"Sending...":"Send",P,B,A,W,b=a[0].description&&ce(a);function X(f,v){return f[1].length===0?Le:He}let U=X(a),C=U(a);return{c(){t=p("div"),e=p("div"),s=p("div"),r=p("button"),r.textContent=o,n=N(),l=p("h1"),E=F(i),S=N(),b&&b.c(),g=N(),h=p("div"),D=p("div"),C.c(),V=N(),w=p("div"),_=p("div"),I=p("form"),k=p("input"),K=N(),T=p("button"),P=F(L),this.h()},l(f){t=m(f,"DIV",{class:!0});var v=y(t);e=m(v,"DIV",{class:!0});var Y=y(e);s=m(Y,"DIV",{class:!0});var H=y(s);r=m(H,"BUTTON",{class:!0,"data-svelte-h":!0}),Q(r)!=="svelte-1ccmdp8"&&(r.textContent=o),n=M(H),l=m(H,"H1",{class:!0});var Z=y(l);E=x(Z,i),Z.forEach(d),S=M(H),b&&b.l(H),H.forEach(d),Y.forEach(d),g=M(v),h=m(v,"DIV",{class:!0});var $=y(h);D=m($,"DIV",{class:!0});var ee=y(D);C.l(ee),ee.forEach(d),$.forEach(d),V=M(v),w=m(v,"DIV",{class:!0});var te=y(w);_=m(te,"DIV",{class:!0});var se=y(_);I=m(se,"FORM",{class:!0});var q=y(I);k=m(q,"INPUT",{type:!0,class:!0,placeholder:!0}),K=M(q),T=m(q,"BUTTON",{type:!0,class:!0});var ne=y(T);P=x(ne,L),ne.forEach(d),q.forEach(d),se.forEach(d),te.forEach(d),v.forEach(d),this.h()},h(){u(r,"class","btn btn-ghost btn-sm mb-2"),u(l,"class","text-2xl font-bold"),u(s,"class","container mx-auto max-w-4xl"),u(e,"class","bg-base-200 border-b border-base-300 p-4"),u(D,"class","container mx-auto max-w-4xl"),u(h,"class","flex-1 overflow-y-auto p-4 bg-base-100"),u(k,"type","text"),u(k,"class","input input-bordered flex-1"),u(k,"placeholder","Type a message..."),k.disabled=a[4],u(T,"type","submit"),u(T,"class","btn btn-primary"),T.disabled=B=a[4]||!a[2].trim(),u(I,"class","flex gap-2"),u(_,"class","container mx-auto max-w-4xl"),u(w,"class","bg-base-200 border-t border-base-300 p-4"),u(t,"class","flex flex-col h-[calc(100vh-64px)]")},m(f,v){j(f,t,v),c(t,e),c(e,s),c(s,r),c(s,n),c(s,l),c(l,E),c(s,S),b&&b.m(s,null),c(t,g),c(t,h),c(h,D),C.m(D,null),a[9](h),c(t,V),c(t,w),c(w,_),c(_,I),c(I,k),re(k,a[2]),c(I,K),c(I,T),c(T,P),A||(W=[R(r,"click",a[8]),R(k,"input",a[10]),R(I,"submit",ye(a[6]))],A=!0)},p(f,v){v&1&&i!==(i=f[0].name+"")&&O(E,i),f[0].description?b?b.p(f,v):(b=ce(f),b.c(),b.m(s,null)):b&&(b.d(1),b=null),U===(U=X(f))&&C?C.p(f,v):(C.d(1),C=U(f),C&&(C.c(),C.m(D,null))),v&16&&(k.disabled=f[4]),v&4&&k.value!==f[2]&&re(k,f[2]),v&16&&L!==(L=f[4]?"Sending...":"Send")&&O(P,L),v&20&&B!==(B=f[4]||!f[2].trim())&&(T.disabled=B)},d(f){f&&d(t),b&&b.d(),C.d(),a[9](null),A=!1,ge(W)}}}function je(a){let t,e='<div class="loading loading-spinner loading-lg text-primary"></div>';return{c(){t=p("div"),t.innerHTML=e,this.h()},l(s){t=m(s,"DIV",{class:!0,"data-svelte-h":!0}),Q(t)!=="svelte-mo2ait"&&(t.innerHTML=e),this.h()},h(){u(t,"class","flex justify-center items-center h-[calc(100vh-64px)]")},m(s,r){j(s,t,r)},p:z,d(s){s&&d(t)}}}function ce(a){let t,e=a[0].description+"",s;return{c(){t=p("p"),s=F(e),this.h()},l(r){t=m(r,"P",{class:!0});var o=y(t);s=x(o,e),o.forEach(d),this.h()},h(){u(t,"class","text-base-content/70 text-sm")},m(r,o){j(r,t,o),c(t,s)},p(r,o){o&1&&e!==(e=r[0].description+"")&&O(s,e)},d(r){r&&d(t)}}}function He(a){let t,e=[],s=new Map,r=ie(a[1]);const o=n=>n[13].id;for(let n=0;n<r.length;n+=1){let l=oe(a,r,n),i=o(l);s.set(i,e[n]=de(i,l))}return{c(){t=p("div");for(let n=0;n<e.length;n+=1)e[n].c();this.h()},l(n){t=m(n,"DIV",{class:!0});var l=y(t);for(let i=0;i<e.length;i+=1)e[i].l(l);l.forEach(d),this.h()},h(){u(t,"class","space-y-4")},m(n,l){j(n,t,l);for(let i=0;i<e.length;i+=1)e[i]&&e[i].m(t,null)},p(n,l){l&2&&(r=ie(n[1]),e=ke(e,l,o,1,n,r,s,t,Ie,de,null,oe))},d(n){n&&d(t);for(let l=0;l<e.length;l+=1)e[l].d()}}}function Le(a){let t,e="<p>No messages yet. Start the conversation!</p>";return{c(){t=p("div"),t.innerHTML=e,this.h()},l(s){t=m(s,"DIV",{class:!0,"data-svelte-h":!0}),Q(t)!=="svelte-jcsddy"&&(t.innerHTML=e),this.h()},h(){u(t,"class","flex items-center justify-center h-full text-base-content/50")},m(s,r){j(s,t,r)},p:z,d(s){s&&d(t)}}}function de(a,t){let e,s,r=t[13].content+"",o,n,l,i=ue(t[13].created_at)+"",E,S;return{key:a,first:null,c(){e=p("div"),s=p("div"),o=F(r),n=N(),l=p("div"),E=F(i),S=N(),this.h()},l(g){e=m(g,"DIV",{class:!0});var h=y(e);s=m(h,"DIV",{class:!0});var D=y(s);o=x(D,r),D.forEach(d),n=M(h),l=m(h,"DIV",{class:!0});var V=y(l);E=x(V,i),V.forEach(d),S=M(h),h.forEach(d),this.h()},h(){u(s,"class","chat-bubble"),u(l,"class","chat-footer opacity-50 text-xs"),u(e,"class","chat chat-start"),this.first=e},m(g,h){j(g,e,h),c(e,s),c(s,o),c(e,n),c(e,l),c(l,E),c(e,S)},p(g,h){t=g,h&2&&r!==(r=t[13].content+"")&&O(o,r),h&2&&i!==(i=ue(t[13].created_at)+"")&&O(E,i)},d(g){g&&d(e)}}}function Oe(a){let t,e,s;document.title=t=(a[0]?.name||"Channel")+" - Fairfield Nostr";function r(l,i){if(l[3])return je;if(l[0])return Ne}let o=r(a),n=o&&o(a);return{c(){e=N(),n&&n.c(),s=le()},l(l){pe("svelte-1m1z3s6",document.head).forEach(d),e=M(l),n&&n.l(l),s=le()},m(l,i){j(l,e,i),n&&n.m(l,i),j(l,s,i)},p(l,[i]){i&1&&t!==(t=(l[0]?.name||"Channel")+" - Fairfield Nostr")&&(document.title=t),o===(o=r(l))&&n?n.p(l,i):(n&&n.d(1),n=o&&o(l),n&&(n.c(),n.m(s.parentNode,s)))},i:z,o:z,d(l){l&&(d(e),d(s)),n&&n.d(l)}}}function ue(a){return new Date(a*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function xe(a,t,e){let s,r,o;ae(a,Ve,_=>e(12,r=_)),ae(a,De,_=>e(7,o=_));let n=null,l=[],i="",E=!0,S=!1,g;ve(async()=>{if(!r.isAuthenticated){G(`${J}/`);return}try{const _=await Ce.getNDK(),I=await Te.fetchChannels(_,r.publicKey,["business","moomaa-tribe"]);if(e(0,n=I.find(k=>k.id===s)||null),!n){G(`${J}/chat`);return}e(1,l=[])}catch(_){console.error("Error loading channel:",_)}finally{e(3,E=!1)}});async function h(){if(!i.trim()||S||!n)return;e(4,S=!0);const _=i;e(2,i="");try{console.log("Sending message:",_)}catch(I){console.error("Error sending message:",I),e(2,i=_)}finally{e(4,S=!1)}}const D=()=>G(`${J}/chat`);function V(_){be[_?"unshift":"push"](()=>{g=_,e(5,g)})}function w(){i=this.value,e(2,i)}return a.$$.update=()=>{a.$$.dirty&128&&(s=o.params.channelId)},[n,l,i,E,S,g,h,o,D,V,w]}class Je extends Ee{constructor(t){super(),Se(this,t,xe,Oe,me,{})}}export{Je as component,Ge as universal};
//# sourceMappingURL=5.Ffssueda.js.map
