import{n as ke,b as De}from"../chunks/Dj2A1cQj.js";import{s as Ee,n as R,d as c,i as N,m as Ie,g as T,u as fe,j as w,k as he,p as Se,v as Ve,l as u,c as d,o as $,h as f,w as Me,a as L,x as pe,b as i,q as Z,y as Te,e as v,f as x,t as A}from"../chunks/B7P-bQO9.js";import{e as _e,u as we,d as Pe}from"../chunks/C3bkP_Kp.js";import{S as Ce,i as Ne}from"../chunks/BuTC0y2q.js";import{g as ve}from"../chunks/3iu1C0Kx.js";import{p as je}from"../chunks/D30foP-V.js";import{b as be}from"../chunks/DkN-uFVr.js";import{a as Oe}from"../chunks/CshrlUFe.js";const Ue=!1,He=async({params:l})=>{const t=localStorage.getItem("fairfield_auth");if(!t)return{messages:[],recipientPubkey:l.pubkey};try{const e=JSON.parse(t),a=ke.get();return!a||!e.npub?{messages:[],recipientPubkey:l.pubkey}:{messages:await De(a,e.npub,l.pubkey),recipientPubkey:l.pubkey,currentUserPubkey:e.npub}}catch(e){return console.error("Failed to load conversation:",e),{messages:[],recipientPubkey:l.pubkey}}},Ye=Object.freeze(Object.defineProperty({__proto__:null,load:He,prerender:Ue},Symbol.toStringTag,{value:"Module"}));function me(l,t,e){const a=l.slice();return a[12]=t[e],a}function Le(l){let t,e,a,o,h="‚Üê Back to Messages",r,s,n,g,k,D=l[5].charAt(0).toUpperCase()+"",y,b,I,_=G(l[5])+"",j,Q,P,C,W,O,U,V,E,X,M,H=l[3]?"Sending...":"Send",F,B,Y,ee;function te(p,m){return p[0].length===0?Fe:Ae}let q=te(l),S=q(l);return{c(){t=f("div"),e=f("div"),a=f("div"),o=f("button"),o.textContent=h,r=w(),s=f("div"),n=f("div"),g=f("div"),k=f("span"),y=A(D),b=w(),I=f("h1"),j=A(_),Q=w(),P=f("div"),C=f("div"),S.c(),W=w(),O=f("div"),U=f("div"),V=f("form"),E=f("input"),X=w(),M=f("button"),F=A(H),this.h()},l(p){t=d(p,"DIV",{class:!0});var m=v(t);e=d(m,"DIV",{class:!0});var se=v(e);a=d(se,"DIV",{class:!0});var z=v(a);o=d(z,"BUTTON",{class:!0,"data-svelte-h":!0}),$(o)!=="svelte-2onyz5"&&(o.textContent=h),r=T(z),s=d(z,"DIV",{class:!0});var K=v(s);n=d(K,"DIV",{class:!0});var ae=v(n);g=d(ae,"DIV",{class:!0});var le=v(g);k=d(le,"SPAN",{});var re=v(k);y=x(re,D),re.forEach(c),le.forEach(c),ae.forEach(c),b=T(K),I=d(K,"H1",{class:!0});var ne=v(I);j=x(ne,_),ne.forEach(c),K.forEach(c),z.forEach(c),se.forEach(c),Q=T(m),P=d(m,"DIV",{class:!0});var oe=v(P);C=d(oe,"DIV",{class:!0});var ie=v(C);S.l(ie),ie.forEach(c),oe.forEach(c),W=T(m),O=d(m,"DIV",{class:!0});var ce=v(O);U=d(ce,"DIV",{class:!0});var ue=v(U);V=d(ue,"FORM",{class:!0});var J=v(V);E=d(J,"INPUT",{type:!0,class:!0,placeholder:!0}),X=T(J),M=d(J,"BUTTON",{type:!0,class:!0});var de=v(M);F=x(de,H),de.forEach(c),J.forEach(c),ue.forEach(c),ce.forEach(c),m.forEach(c),this.h()},h(){u(o,"class","btn btn-ghost btn-sm mb-2"),u(g,"class","bg-primary text-primary-content rounded-full w-10"),u(n,"class","avatar placeholder"),u(I,"class","text-xl font-bold"),u(s,"class","flex items-center gap-3"),u(a,"class","container mx-auto max-w-2xl"),u(e,"class","bg-base-200 border-b border-base-300 p-4"),u(C,"class","container mx-auto max-w-2xl"),u(P,"class","flex-1 overflow-y-auto p-4 bg-base-100"),u(E,"type","text"),u(E,"class","input input-bordered flex-1"),u(E,"placeholder","Type a message..."),E.disabled=l[3],u(M,"type","submit"),u(M,"class","btn btn-primary"),M.disabled=B=l[3]||!l[1].trim(),u(V,"class","flex gap-2"),u(U,"class","container mx-auto max-w-2xl"),u(O,"class","bg-base-200 border-t border-base-300 p-4"),u(t,"class","flex flex-col h-[calc(100vh-64px)]")},m(p,m){N(p,t,m),i(t,e),i(e,a),i(a,o),i(a,r),i(a,s),i(s,n),i(n,g),i(g,k),i(k,y),i(s,b),i(s,I),i(I,j),i(t,Q),i(t,P),i(P,C),S.m(C,null),l[10](P),i(t,W),i(t,O),i(O,U),i(U,V),i(V,E),pe(E,l[1]),i(V,X),i(V,M),i(M,F),Y||(ee=[Z(o,"click",l[9]),Z(E,"input",l[11]),Z(V,"submit",Te(l[7]))],Y=!0)},p(p,m){m&32&&D!==(D=p[5].charAt(0).toUpperCase()+"")&&L(y,D),m&32&&_!==(_=G(p[5])+"")&&L(j,_),q===(q=te(p))&&S?S.p(p,m):(S.d(1),S=q(p),S&&(S.c(),S.m(C,null))),m&8&&(E.disabled=p[3]),m&2&&E.value!==p[1]&&pe(E,p[1]),m&8&&H!==(H=p[3]?"Sending...":"Send")&&L(F,H),m&10&&B!==(B=p[3]||!p[1].trim())&&(M.disabled=B)},d(p){p&&c(t),S.d(),l[10](null),Y=!1,Me(ee)}}}function xe(l){let t,e='<div class="loading loading-spinner loading-lg text-primary"></div>';return{c(){t=f("div"),t.innerHTML=e,this.h()},l(a){t=d(a,"DIV",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-mo2ait"&&(t.innerHTML=e),this.h()},h(){u(t,"class","flex justify-center items-center h-[calc(100vh-64px)]")},m(a,o){N(a,t,o)},p:R,d(a){a&&c(t)}}}function Ae(l){let t,e=[],a=new Map,o=_e(l[0]);const h=r=>r[12].id;for(let r=0;r<o.length;r+=1){let s=me(l,o,r),n=h(s);a.set(n,e[r]=ge(n,s))}return{c(){t=f("div");for(let r=0;r<e.length;r+=1)e[r].c();this.h()},l(r){t=d(r,"DIV",{class:!0});var s=v(t);for(let n=0;n<e.length;n+=1)e[n].l(s);s.forEach(c),this.h()},h(){u(t,"class","space-y-2")},m(r,s){N(r,t,s);for(let n=0;n<e.length;n+=1)e[n]&&e[n].m(t,null)},p(r,s){s&65&&(o=_e(r[0]),e=we(e,s,h,1,r,o,a,t,Pe,ge,null,me))},d(r){r&&c(t);for(let s=0;s<e.length;s+=1)e[s].d()}}}function Fe(l){let t,e="<p>No messages yet. Start the conversation!</p>";return{c(){t=f("div"),t.innerHTML=e,this.h()},l(a){t=d(a,"DIV",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-jcsddy"&&(t.innerHTML=e),this.h()},h(){u(t,"class","flex items-center justify-center h-full text-base-content/50")},m(a,o){N(a,t,o)},p:R,d(a){a&&c(t)}}}function ge(l,t){let e,a,o=t[12].content+"",h,r,s,n=ye(t[12].created_at)+"",g,k,D;return{key:l,first:null,c(){e=f("div"),a=f("div"),h=A(o),r=w(),s=f("div"),g=A(n),k=w(),this.h()},l(y){e=d(y,"DIV",{class:!0});var b=v(e);a=d(b,"DIV",{class:!0});var I=v(a);h=x(I,o),I.forEach(c),r=T(b),s=d(b,"DIV",{class:!0});var _=v(s);g=x(_,n),_.forEach(c),k=T(b),b.forEach(c),this.h()},h(){u(a,"class","chat-bubble"),u(s,"class","chat-footer opacity-50 text-xs"),u(e,"class",D="chat "+(t[12].pubkey===t[6].publicKey?"chat-end":"chat-start")),this.first=e},m(y,b){N(y,e,b),i(e,a),i(a,h),i(e,r),i(e,s),i(s,g),i(e,k)},p(y,b){t=y,b&1&&o!==(o=t[12].content+"")&&L(h,o),b&1&&n!==(n=ye(t[12].created_at)+"")&&L(g,n),b&65&&D!==(D="chat "+(t[12].pubkey===t[6].publicKey?"chat-end":"chat-start"))&&u(e,"class",D)},d(y){y&&c(e)}}}function Be(l){let t,e,a;document.title=t="DM with "+G(l[5])+" - Fairfield Nostr";function o(s,n){return s[2]?xe:Le}let h=o(l),r=h(l);return{c(){e=w(),r.c(),a=fe()},l(s){Ie("svelte-ggt8r8",document.head).forEach(c),e=T(s),r.l(s),a=fe()},m(s,n){N(s,e,n),r.m(s,n),N(s,a,n)},p(s,[n]){n&32&&t!==(t="DM with "+G(s[5])+" - Fairfield Nostr")&&(document.title=t),h===(h=o(s))&&r?r.p(s,n):(r.d(1),r=h(s),r&&(r.c(),r.m(a.parentNode,a)))},i:R,o:R,d(s){s&&(c(e),c(a)),r.d(s)}}}function ye(l){return new Date(l*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function G(l){return l.slice(0,12)+"..."+l.slice(-8)}function qe(l,t,e){let a,o,h;he(l,Oe,_=>e(6,o=_)),he(l,je,_=>e(8,h=_));let r=[],s="",n=!0,g=!1,k;Se(async()=>{if(!o.isAuthenticated){ve(`${be}/`);return}e(0,r=[]),e(2,n=!1)});async function D(){if(!s.trim()||g)return;e(3,g=!0);const _=s;e(1,s="");try{console.log("Sending DM:",_)}catch(j){console.error("Error sending DM:",j),e(1,s=_)}finally{e(3,g=!1)}}const y=()=>ve(`${be}/dm`);function b(_){Ve[_?"unshift":"push"](()=>{k=_,e(4,k)})}function I(){s=this.value,e(1,s)}return l.$$.update=()=>{l.$$.dirty&256&&e(5,a=h.params.pubkey)},[r,s,n,g,k,a,o,D,h,y,b,I]}class Ze extends Ce{constructor(t){super(),Ne(this,t,qe,Be,Ee,{})}}export{Ze as component,Ye as universal};
//# sourceMappingURL=7.C6kHHPp-.js.map
