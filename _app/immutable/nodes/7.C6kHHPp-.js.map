{"version":3,"file":"7.C6kHHPp-.js","sources":["../../../../../../src/routes/dm/[pubkey]/+page.ts","../../../../../../src/routes/dm/[pubkey]/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\nimport { browser } from '$app/environment';\nimport { ndkStore, fetchDirectMessages } from '$lib/stores/ndk';\n\n// Dynamic routes can't be prerendered\nexport const prerender = false;\n\nexport const load: PageLoad = async ({ params }) => {\n  if (!browser) {\n    return { messages: [], recipientPubkey: params.pubkey };\n  }\n\n  const stored = localStorage.getItem('fairfield_auth');\n  if (!stored) {\n    // Auth check handled in component\n    return { messages: [], recipientPubkey: params.pubkey };\n  }\n\n  try {\n    const auth = JSON.parse(stored);\n    const ndk = ndkStore.get();\n\n    if (!ndk || !auth.npub) {\n      return { messages: [], recipientPubkey: params.pubkey };\n    }\n\n    const messages = await fetchDirectMessages(ndk, auth.npub, params.pubkey);\n\n    return {\n      messages,\n      recipientPubkey: params.pubkey,\n      currentUserPubkey: auth.npub\n    };\n  } catch (error) {\n    console.error('Failed to load conversation:', error);\n    return { messages: [], recipientPubkey: params.pubkey };\n  }\n};\n","<script lang=\"ts\">\n  import { onMount } from 'svelte';\n  import { goto } from '$app/navigation';\n  import { page } from '$app/stores';\n  import { base } from '$app/paths';\n  import { authStore } from '$lib/stores/auth';\n\n  $: recipientPubkey = $page.params.pubkey;\n\n  let messages: any[] = [];\n  let messageInput = '';\n  let loading = true;\n  let sending = false;\n  let messagesContainer: HTMLDivElement;\n\n  onMount(async () => {\n    if (!$authStore.isAuthenticated) {\n      goto(`${base}/`);\n      return;\n    }\n\n    // Load messages (placeholder)\n    messages = [];\n    loading = false;\n  });\n\n  async function sendMessage() {\n    if (!messageInput.trim() || sending) return;\n\n    sending = true;\n    const content = messageInput;\n    messageInput = '';\n\n    try {\n      // Implement actual DM sending\n      console.log('Sending DM:', content);\n    } catch (error) {\n      console.error('Error sending DM:', error);\n      messageInput = content;\n    } finally {\n      sending = false;\n    }\n  }\n\n  function formatTime(timestamp: number): string {\n    return new Date(timestamp * 1000).toLocaleTimeString([], {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  }\n\n  function formatPubkey(pubkey: string): string {\n    return pubkey.slice(0, 12) + '...' + pubkey.slice(-8);\n  }\n</script>\n\n<svelte:head>\n  <title>DM with {formatPubkey(recipientPubkey)} - Fairfield Nostr</title>\n</svelte:head>\n\n{#if loading}\n  <div class=\"flex justify-center items-center h-[calc(100vh-64px)]\">\n    <div class=\"loading loading-spinner loading-lg text-primary\"></div>\n  </div>\n{:else}\n  <div class=\"flex flex-col h-[calc(100vh-64px)]\">\n    <div class=\"bg-base-200 border-b border-base-300 p-4\">\n      <div class=\"container mx-auto max-w-2xl\">\n        <button class=\"btn btn-ghost btn-sm mb-2\" on:click={() => goto(`${base}/dm`)}>\n          ‚Üê Back to Messages\n        </button>\n        <div class=\"flex items-center gap-3\">\n          <div class=\"avatar placeholder\">\n            <div class=\"bg-primary text-primary-content rounded-full w-10\">\n              <span>{recipientPubkey.charAt(0).toUpperCase()}</span>\n            </div>\n          </div>\n          <h1 class=\"text-xl font-bold\">{formatPubkey(recipientPubkey)}</h1>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"flex-1 overflow-y-auto p-4 bg-base-100\" bind:this={messagesContainer}>\n      <div class=\"container mx-auto max-w-2xl\">\n        {#if messages.length === 0}\n          <div class=\"flex items-center justify-center h-full text-base-content/50\">\n            <p>No messages yet. Start the conversation!</p>\n          </div>\n        {:else}\n          <div class=\"space-y-2\">\n            {#each messages as message (message.id)}\n              <div class=\"chat {message.pubkey === $authStore.publicKey ? 'chat-end' : 'chat-start'}\">\n                <div class=\"chat-bubble\">\n                  {message.content}\n                </div>\n                <div class=\"chat-footer opacity-50 text-xs\">\n                  {formatTime(message.created_at)}\n                </div>\n              </div>\n            {/each}\n          </div>\n        {/if}\n      </div>\n    </div>\n\n    <div class=\"bg-base-200 border-t border-base-300 p-4\">\n      <div class=\"container mx-auto max-w-2xl\">\n        <form on:submit|preventDefault={sendMessage} class=\"flex gap-2\">\n          <input\n            type=\"text\"\n            class=\"input input-bordered flex-1\"\n            placeholder=\"Type a message...\"\n            bind:value={messageInput}\n            disabled={sending}\n          />\n          <button\n            type=\"submit\"\n            class=\"btn btn-primary\"\n            disabled={sending || !messageInput.trim()}\n          >\n            {sending ? 'Sending...' : 'Send'}\n          </button>\n        </form>\n      </div>\n    </div>\n  </div>\n{/if}\n"],"names":["prerender","load","params","stored","auth","ndk","ndkStore","fetchDirectMessages","error","t2_value","ctx","t4_value","formatPubkey","create_if_block_1","insert_hydration","target","div9","anchor","append_hydration","div4","div3","button0","div2","div1","div0","span","h1","div6","div5","div8","div7","form","input","button1","dirty","set_data","t2","t4","t8","t8_value","get_key","i","div","t0_value","formatTime","attr","div2_class_value","t0","title_value","create_if_block","timestamp","pubkey","messages","messageInput","loading","sending","messagesContainer","onMount","$authStore","goto","base","$$invalidate","sendMessage","content","click_handler","$$value","recipientPubkey","$page"],"mappings":"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"}