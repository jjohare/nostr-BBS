import{n as de,b as ue}from"../chunks/Dj2A1cQj.js";import{s as fe,n as U,d,i as E,b as c,l as f,m as he,g as M,c as h,e as _,o as Y,j as D,h as p,k as pe,p as ve,a as C,q as _e,f as H,t as P}from"../chunks/B7P-bQO9.js";import{e as te,u as me,d as be}from"../chunks/C3bkP_Kp.js";import{S as ge,i as ke}from"../chunks/BuTC0y2q.js";import{g as se}from"../chunks/3iu1C0Kx.js";import{b as ae}from"../chunks/DkN-uFVr.js";import{a as ye}from"../chunks/CshrlUFe.js";const Me=!0,De=async()=>{const o=localStorage.getItem("fairfield_auth");if(!o)return{conversations:[]};try{const e=JSON.parse(o),t=de.get();if(!t||!e.npub)return{conversations:[]};const s=await ue(t,e.npub),a=new Map;return s.forEach(n=>{const l=n.pubkey===e.npub?n.recipient:n.pubkey;if(!a.has(l))a.set(l,{pubkey:l,lastMessage:n,unread:0});else{const r=a.get(l);n.created_at>r.lastMessage.created_at&&(r.lastMessage=n)}}),{conversations:Array.from(a.values()).sort((n,l)=>l.lastMessage.created_at-n.lastMessage.created_at)}}catch(e){return console.error("Failed to load DMs:",e),{conversations:[]}}},Ae=Object.freeze(Object.defineProperty({__proto__:null,load:De,prerender:Me},Symbol.toStringTag,{value:"Module"}));function ne(o,e,t){const s=o.slice();return s[5]=e[t],s}function Ee(o){let e,t=[],s=new Map,a=te(o[0]);const i=n=>n[5].pubkey;for(let n=0;n<a.length;n+=1){let l=ne(o,a,n),r=i(l);s.set(r,t[n]=le(r,l))}return{c(){e=p("div");for(let n=0;n<t.length;n+=1)t[n].c();this.h()},l(n){e=h(n,"DIV",{class:!0});var l=_(e);for(let r=0;r<t.length;r+=1)t[r].l(l);l.forEach(d),this.h()},h(){f(e,"class","space-y-2")},m(n,l){E(n,e,l);for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(e,null)},p(n,l){l&5&&(a=te(n[0]),t=me(t,l,i,1,n,a,s,e,be,le,null,ne))},d(n){n&&d(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function xe(o){let e,t='<div class="card-body items-center text-center"><p class="text-base-content/70">No conversations yet. Start chatting!</p></div>';return{c(){e=p("div"),e.innerHTML=t,this.h()},l(s){e=h(s,"DIV",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-19hfe4u"&&(e.innerHTML=t),this.h()},h(){f(e,"class","card bg-base-200")},m(s,a){E(s,e,a)},p:U,d(s){s&&d(e)}}}function Se(o){let e,t='<div class="loading loading-spinner loading-lg text-primary"></div>';return{c(){e=p("div"),e.innerHTML=t,this.h()},l(s){e=h(s,"DIV",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-hu9n30"&&(e.innerHTML=t),this.h()},h(){f(e,"class","flex justify-center items-center min-h-[400px]")},m(s,a){E(s,e,a)},p:U,d(s){s&&d(e)}}}function re(o){let e,t=o[5].unread+"",s;return{c(){e=p("div"),s=P(t),this.h()},l(a){e=h(a,"DIV",{class:!0});var i=_(e);s=H(i,t),i.forEach(d),this.h()},h(){f(e,"class","badge badge-primary badge-sm")},m(a,i){E(a,e,i),c(e,s)},p(a,i){i&1&&t!==(t=a[5].unread+"")&&C(s,t)},d(a){a&&d(e)}}}function le(o,e){let t,s,a,i,n,l,r=e[5].pubkey.charAt(0).toUpperCase()+"",u,g,m,k,x,T=oe(e[5].pubkey)+"",j,F,S,V=ie(e[5].lastMessage.created_at)+"",A,$,w,L=e[5].lastMessage.content+"",N,z,B,J,G,v=e[5].unread>0&&re(e);function ce(){return e[3](e[5])}return{key:o,first:null,c(){t=p("button"),s=p("div"),a=p("div"),i=p("div"),n=p("div"),l=p("span"),u=P(r),g=D(),m=p("div"),k=p("div"),x=p("h3"),j=P(T),F=D(),S=p("span"),A=P(V),$=D(),w=p("p"),N=P(L),z=D(),v&&v.c(),B=D(),this.h()},l(y){t=h(y,"BUTTON",{class:!0});var b=_(t);s=h(b,"DIV",{class:!0});var K=_(s);a=h(K,"DIV",{class:!0});var I=_(a);i=h(I,"DIV",{class:!0});var Q=_(i);n=h(Q,"DIV",{class:!0});var R=_(n);l=h(R,"SPAN",{class:!0});var W=_(l);u=H(W,r),W.forEach(d),R.forEach(d),Q.forEach(d),g=M(I),m=h(I,"DIV",{class:!0});var O=_(m);k=h(O,"DIV",{class:!0});var q=_(k);x=h(q,"H3",{class:!0});var X=_(x);j=H(X,T),X.forEach(d),F=M(q),S=h(q,"SPAN",{class:!0});var Z=_(S);A=H(Z,V),Z.forEach(d),q.forEach(d),$=M(O),w=h(O,"P",{class:!0});var ee=_(w);N=H(ee,L),ee.forEach(d),O.forEach(d),z=M(I),v&&v.l(I),I.forEach(d),K.forEach(d),B=M(b),b.forEach(d),this.h()},h(){f(l,"class","text-xl"),f(n,"class","bg-primary text-primary-content rounded-full w-12"),f(i,"class","avatar placeholder"),f(x,"class","font-semibold"),f(S,"class","text-xs text-base-content/60"),f(k,"class","flex justify-between items-start mb-1"),f(w,"class","text-sm text-base-content/70 truncate"),f(m,"class","flex-1 min-w-0"),f(a,"class","flex items-center gap-3"),f(s,"class","card-body p-4"),f(t,"class","card bg-base-200 hover:bg-base-300 transition-base cursor-pointer w-full text-left"),this.first=t},m(y,b){E(y,t,b),c(t,s),c(s,a),c(a,i),c(i,n),c(n,l),c(l,u),c(a,g),c(a,m),c(m,k),c(k,x),c(x,j),c(k,F),c(k,S),c(S,A),c(m,$),c(m,w),c(w,N),c(a,z),v&&v.m(a,null),c(t,B),J||(G=_e(t,"click",ce),J=!0)},p(y,b){e=y,b&1&&r!==(r=e[5].pubkey.charAt(0).toUpperCase()+"")&&C(u,r),b&1&&T!==(T=oe(e[5].pubkey)+"")&&C(j,T),b&1&&V!==(V=ie(e[5].lastMessage.created_at)+"")&&C(A,V),b&1&&L!==(L=e[5].lastMessage.content+"")&&C(N,L),e[5].unread>0?v?v.p(e,b):(v=re(e),v.c(),v.m(a,null)):v&&(v.d(1),v=null)},d(y){y&&d(t),v&&v.d(),J=!1,G()}}}function we(o){let e,t,s,a='<h1 class="text-4xl font-bold gradient-text mb-2">Direct Messages</h1> <p class="text-base-content/70">Private encrypted conversations</p>',i;function n(u,g){return u[1]?Se:u[0].length===0?xe:Ee}let l=n(o),r=l(o);return{c(){e=D(),t=p("div"),s=p("div"),s.innerHTML=a,i=D(),r.c(),this.h()},l(u){he("svelte-7qc8wd",document.head).forEach(d),e=M(u),t=h(u,"DIV",{class:!0});var m=_(t);s=h(m,"DIV",{class:!0,"data-svelte-h":!0}),Y(s)!=="svelte-14jg3ur"&&(s.innerHTML=a),i=M(m),r.l(m),m.forEach(d),this.h()},h(){document.title="Direct Messages - Fairfield Nostr",f(s,"class","mb-6"),f(t,"class","container mx-auto p-4 max-w-2xl")},m(u,g){E(u,e,g),E(u,t,g),c(t,s),c(t,i),r.m(t,null)},p(u,[g]){l===(l=n(u))&&r?r.p(u,g):(r.d(1),r=l(u),r&&(r.c(),r.m(t,null)))},i:U,o:U,d(u){u&&(d(e),d(t)),r.d()}}}function oe(o){return o.slice(0,12)+"..."+o.slice(-8)}function ie(o){const e=new Date(o*1e3),a=(new Date().getTime()-e.getTime())/(1e3*60*60);return a<24?e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):a<48?"Yesterday":e.toLocaleDateString()}function Ie(o,e,t){let s;pe(o,ye,r=>t(4,s=r));let a=[],i=!0;ve(async()=>{if(!s.isAuthenticated){se(`${ae}/`);return}t(0,a=[]),t(1,i=!1)});function n(r){se(`${ae}/dm/${r}`)}return[a,i,n,r=>n(r.pubkey)]}class Ne extends ge{constructor(e){super(),ke(this,e,Ie,we,fe,{})}}export{Ne as component,Ae as universal};
//# sourceMappingURL=6.DG3FtEJe.js.map
