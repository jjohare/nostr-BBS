import{M as me,s as be,n as G,d as h,i as A,m as ve,g as N,B as re,j as V,k as oe,p as ge,C as ye,l as m,c as b,o as W,h as v,r as Ce,a as U,w as ie,b as d,q as z,D as ke,e as D,f as j,t as B}from"../chunks/DzI9cZK7.js";import{e as ce,u as Ee,d as Ie}from"../chunks/BJVAiE7y.js";import{S as De,i as Me}from"../chunks/DQ8TXwry.js";import{g as J}from"../chunks/vfioTGuK.js";import{p as Se}from"../chunks/DCk5VxIa.js";import{w as Te,b as Q}from"../chunks/CbfuHqtt.js";import{a as we}from"../chunks/CnQ7tD4U.js";import{n as Ne}from"../chunks/QaGk0KJq.js";const Ve=!1,Ae=async({params:s})=>({channelId:s.channelId,channel:null,messages:[]}),lt=Object.freeze(Object.defineProperty({__proto__:null,load:Ae,prerender:Ve},Symbol.toStringTag,{value:"Module"})),qe=39e3,Oe=39002,Pe=9021,pe={channels:[],loading:!1,error:null,currentChannel:null},{subscribe:Re,set:_e,update:O}=Te(pe);async function Ue(s,e,t){O(n=>({...n,loading:!0,error:null}));try{const n={kinds:[qe]},o=await s.fetchEvents(n),i=Array.from(o),a={kinds:[Oe]},l=await s.fetchEvents(a),r=Array.from(l),I={kinds:[Pe],authors:[e]},y=await s.fetchEvents(I),_=Array.from(y),u=[];for(const g of i){const M=je(g,r,_,e,t);M&&u.push(M)}return O(g=>({...g,channels:u,loading:!1,error:null})),u}catch(n){const o=n instanceof Error?n.message:"Failed to fetch channels";throw O(i=>({...i,loading:!1,error:o})),n}}function je(s,e,t,n,o){const i=s.tags.find(c=>c[0]==="d")?.[1];if(!i)return null;const a=s.tags.filter(c=>c[0]==="cohort").map(c=>c[1]);if(!a.some(c=>o.includes(c))&&a.length>0)return null;let r={};try{r=JSON.parse(s.content)}catch{r={}}const y=e.find(c=>c.tags.find(q=>q[0]==="d")?.[1]===i)?.tags.filter(c=>c[0]==="p").map(c=>c[1])||[],_=y.length,u=y.includes(n),g=t.some(c=>c.tags.find(q=>q[0]==="h")?.[1]===i),S=s.tags.find(c=>c[0]==="visibility")?.[1]||"listed",f=s.tags.some(c=>c[0]==="encrypted");return!u&&S==="unlisted"?null:{id:i,name:r.name||"Unnamed Channel",description:r.about||"",picture:r.picture,cohorts:a,visibility:S,isEncrypted:f,memberCount:_,createdAt:s.created_at||0,isMember:u,hasRequestPending:g}}function Be(s){O(e=>({...e,currentChannel:s}))}function Fe(){return me(X).currentChannel}function He(s){return me(X).channels.filter(t=>t.cohorts.includes(s))}function Ke(){_e(pe)}function Le(s,e){O(t=>({...t,channels:t.channels.map(n=>n.id===s?{...n,...e}:n)}))}function Ge(s){O(e=>({...e,channels:e.channels.filter(t=>t.id!==s),currentChannel:e.currentChannel?.id===s?null:e.currentChannel}))}const X={subscribe:Re,set:_e,update:O,fetchChannels:Ue,setCurrentChannel:Be,getCurrentChannel:Fe,getChannelsByCohort:He,clearChannels:Ke,updateChannel:Le,removeChannel:Ge};function ue(s,e,t){const n=s.slice();return n[13]=e[t],n}function xe(s){let e,t,n,o,i="‚Üê Back to Channels",a,l,r=s[0].name+"",I,y,_,u,g,M,S,f,c,k,q,w,R=s[4]?"Sending...":"Send",F,H,x,Y,E=s[0].description&&de(s);function Z(p,C){return p[1].length===0?Qe:Je}let K=Z(s),T=K(s);return{c(){e=v("div"),t=v("div"),n=v("div"),o=v("button"),o.textContent=i,a=V(),l=v("h1"),I=B(r),y=V(),E&&E.c(),_=V(),u=v("div"),g=v("div"),T.c(),M=V(),S=v("div"),f=v("div"),c=v("form"),k=v("input"),q=V(),w=v("button"),F=B(R),this.h()},l(p){e=b(p,"DIV",{class:!0});var C=D(e);t=b(C,"DIV",{class:!0});var $=D(t);n=b($,"DIV",{class:!0});var P=D(n);o=b(P,"BUTTON",{class:!0,"data-svelte-h":!0}),W(o)!=="svelte-1ccmdp8"&&(o.textContent=i),a=N(P),l=b(P,"H1",{class:!0});var ee=D(l);I=j(ee,r),ee.forEach(h),y=N(P),E&&E.l(P),P.forEach(h),$.forEach(h),_=N(C),u=b(C,"DIV",{class:!0});var te=D(u);g=b(te,"DIV",{class:!0});var ne=D(g);T.l(ne),ne.forEach(h),te.forEach(h),M=N(C),S=b(C,"DIV",{class:!0});var se=D(S);f=b(se,"DIV",{class:!0});var ae=D(f);c=b(ae,"FORM",{class:!0});var L=D(c);k=b(L,"INPUT",{type:!0,class:!0,placeholder:!0}),q=N(L),w=b(L,"BUTTON",{type:!0,class:!0});var le=D(w);F=j(le,R),le.forEach(h),L.forEach(h),ae.forEach(h),se.forEach(h),C.forEach(h),this.h()},h(){m(o,"class","btn btn-ghost btn-sm mb-2"),m(l,"class","text-2xl font-bold"),m(n,"class","container mx-auto max-w-4xl"),m(t,"class","bg-base-200 border-b border-base-300 p-4"),m(g,"class","container mx-auto max-w-4xl"),m(u,"class","flex-1 overflow-y-auto p-4 bg-base-100"),m(k,"type","text"),m(k,"class","input input-bordered flex-1"),m(k,"placeholder","Type a message..."),k.disabled=s[4],m(w,"type","submit"),m(w,"class","btn btn-primary"),w.disabled=H=s[4]||!s[2].trim(),m(c,"class","flex gap-2"),m(f,"class","container mx-auto max-w-4xl"),m(S,"class","bg-base-200 border-t border-base-300 p-4"),m(e,"class","flex flex-col h-[calc(100vh-64px)]")},m(p,C){A(p,e,C),d(e,t),d(t,n),d(n,o),d(n,a),d(n,l),d(l,I),d(n,y),E&&E.m(n,null),d(e,_),d(e,u),d(u,g),T.m(g,null),s[9](u),d(e,M),d(e,S),d(S,f),d(f,c),d(c,k),ie(k,s[2]),d(c,q),d(c,w),d(w,F),x||(Y=[z(o,"click",s[8]),z(k,"input",s[10]),z(c,"submit",ke(s[6]))],x=!0)},p(p,C){C&1&&r!==(r=p[0].name+"")&&U(I,r),p[0].description?E?E.p(p,C):(E=de(p),E.c(),E.m(n,null)):E&&(E.d(1),E=null),K===(K=Z(p))&&T?T.p(p,C):(T.d(1),T=K(p),T&&(T.c(),T.m(g,null))),C&16&&(k.disabled=p[4]),C&4&&k.value!==p[2]&&ie(k,p[2]),C&16&&R!==(R=p[4]?"Sending...":"Send")&&U(F,R),C&20&&H!==(H=p[4]||!p[2].trim())&&(w.disabled=H)},d(p){p&&h(e),E&&E.d(),T.d(),s[9](null),x=!1,Ce(Y)}}}function ze(s){let e,t='<div class="loading loading-spinner loading-lg text-primary"></div>';return{c(){e=v("div"),e.innerHTML=t,this.h()},l(n){e=b(n,"DIV",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-mo2ait"&&(e.innerHTML=t),this.h()},h(){m(e,"class","flex justify-center items-center h-[calc(100vh-64px)]")},m(n,o){A(n,e,o)},p:G,d(n){n&&h(e)}}}function de(s){let e,t=s[0].description+"",n;return{c(){e=v("p"),n=B(t),this.h()},l(o){e=b(o,"P",{class:!0});var i=D(e);n=j(i,t),i.forEach(h),this.h()},h(){m(e,"class","text-base-content/70 text-sm")},m(o,i){A(o,e,i),d(e,n)},p(o,i){i&1&&t!==(t=o[0].description+"")&&U(n,t)},d(o){o&&h(e)}}}function Je(s){let e,t=[],n=new Map,o=ce(s[1]);const i=a=>a[13].id;for(let a=0;a<o.length;a+=1){let l=ue(s,o,a),r=i(l);n.set(r,t[a]=he(r,l))}return{c(){e=v("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=b(a,"DIV",{class:!0});var l=D(e);for(let r=0;r<t.length;r+=1)t[r].l(l);l.forEach(h),this.h()},h(){m(e,"class","space-y-4")},m(a,l){A(a,e,l);for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(e,null)},p(a,l){l&2&&(o=ce(a[1]),t=Ee(t,l,i,1,a,o,n,e,Ie,he,null,ue))},d(a){a&&h(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function Qe(s){let e,t="<p>No messages yet. Start the conversation!</p>";return{c(){e=v("div"),e.innerHTML=t,this.h()},l(n){e=b(n,"DIV",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-jcsddy"&&(e.innerHTML=t),this.h()},h(){m(e,"class","flex items-center justify-center h-full text-base-content/50")},m(n,o){A(n,e,o)},p:G,d(n){n&&h(e)}}}function he(s,e){let t,n,o=e[13].content+"",i,a,l,r=fe(e[13].created_at)+"",I,y;return{key:s,first:null,c(){t=v("div"),n=v("div"),i=B(o),a=V(),l=v("div"),I=B(r),y=V(),this.h()},l(_){t=b(_,"DIV",{class:!0});var u=D(t);n=b(u,"DIV",{class:!0});var g=D(n);i=j(g,o),g.forEach(h),a=N(u),l=b(u,"DIV",{class:!0});var M=D(l);I=j(M,r),M.forEach(h),y=N(u),u.forEach(h),this.h()},h(){m(n,"class","chat-bubble"),m(l,"class","chat-footer opacity-50 text-xs"),m(t,"class","chat chat-start"),this.first=t},m(_,u){A(_,t,u),d(t,n),d(n,i),d(t,a),d(t,l),d(l,I),d(t,y)},p(_,u){e=_,u&2&&o!==(o=e[13].content+"")&&U(i,o),u&2&&r!==(r=fe(e[13].created_at)+"")&&U(I,r)},d(_){_&&h(t)}}}function We(s){let e,t,n;document.title=e=(s[0]?.name||"Channel")+" - Minimoomaa Noir";function o(l,r){if(l[3])return ze;if(l[0])return xe}let i=o(s),a=i&&i(s);return{c(){t=V(),a&&a.c(),n=re()},l(l){ve("svelte-ldw7qz",document.head).forEach(h),t=N(l),a&&a.l(l),n=re()},m(l,r){A(l,t,r),a&&a.m(l,r),A(l,n,r)},p(l,[r]){r&1&&e!==(e=(l[0]?.name||"Channel")+" - Minimoomaa Noir")&&(document.title=e),i===(i=o(l))&&a?a.p(l,r):(a&&a.d(1),a=i&&i(l),a&&(a.c(),a.m(n.parentNode,n)))},i:G,o:G,d(l){l&&(h(t),h(n)),a&&a.d(l)}}}function fe(s){return new Date(s*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function Xe(s,e,t){let n,o,i;oe(s,we,f=>t(12,o=f)),oe(s,Se,f=>t(7,i=f));let a=null,l=[],r="",I=!0,y=!1,_;ge(async()=>{if(!o.isAuthenticated){J(`${Q}/`);return}try{const f=await Ne.getNDK(),c=await X.fetchChannels(f,o.publicKey,["business","moomaa-tribe"]);if(t(0,a=c.find(k=>k.id===n)||null),!a){J(`${Q}/chat`);return}t(1,l=[])}catch(f){console.error("Error loading channel:",f)}finally{t(3,I=!1)}});async function u(){if(!r.trim()||y||!a)return;t(4,y=!0);const f=r;t(2,r="");try{console.log("Sending message:",f)}catch(c){console.error("Error sending message:",c),t(2,r=f)}finally{t(4,y=!1)}}const g=()=>J(`${Q}/chat`);function M(f){ye[f?"unshift":"push"](()=>{_=f,t(5,_)})}function S(){r=this.value,t(2,r)}return s.$$.update=()=>{s.$$.dirty&128&&(n=i.params.channelId)},[a,l,r,I,y,_,u,i,g,M,S]}class rt extends De{constructor(e){super(),Me(this,e,Xe,We,be,{})}}export{rt as component,lt as universal};
//# sourceMappingURL=5.B1zfPpPy.js.map
