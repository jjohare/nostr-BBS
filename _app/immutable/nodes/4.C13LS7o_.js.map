{"version":3,"file":"4.C13LS7o_.js","sources":["../../../../../../src/routes/chat/+page.ts","../../../../../../src/routes/chat/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\nimport { browser } from '$app/environment';\n\n// Allow prerendering - data is loaded in component\nexport const prerender = true;\n\nexport const load: PageLoad = async () => {\n  // All data loading happens in the component to avoid SSR/prerender issues\n  return { channels: [] };\n};\n","<script lang=\"ts\">\n  import { onMount } from 'svelte';\n  import { goto } from '$app/navigation';\n  import { base } from '$app/paths';\n  import { authStore } from '$lib/stores/auth';\n  import { setSigner, connectNDK } from '$lib/nostr/ndk';\n  import { fetchChannels, type CreatedChannel } from '$lib/nostr/channels';\n\n  let channels: CreatedChannel[] = [];\n  let loading = true;\n  let error: string | null = null;\n\n  onMount(async () => {\n    if (!$authStore.isAuthenticated || !$authStore.publicKey) {\n      goto(`${base}/`);\n      return;\n    }\n\n    try {\n      // Set up signer if we have a private key\n      if ($authStore.privateKey) {\n        setSigner($authStore.privateKey);\n      }\n\n      // Connect and fetch NIP-28 channels (kind 40)\n      await connectNDK();\n      channels = await fetchChannels();\n    } catch (e) {\n      console.error('Failed to load channels:', e);\n      error = e instanceof Error ? e.message : 'Failed to load channels';\n    } finally {\n      loading = false;\n    }\n  });\n\n  function navigateToChannel(channelId: string) {\n    goto(`${base}/chat/${channelId}`);\n  }\n\n  function formatDate(timestamp: number): string {\n    return new Date(timestamp * 1000).toLocaleDateString();\n  }\n</script>\n\n<svelte:head>\n  <title>Channels - Minimoomaa Noir</title>\n</svelte:head>\n\n<div class=\"container mx-auto p-4 max-w-4xl\">\n  <div class=\"mb-6\">\n    <h1 class=\"text-4xl font-bold gradient-text mb-2\">Channels</h1>\n    <p class=\"text-base-content/70\">Join conversations in public channels</p>\n  </div>\n\n  {#if loading}\n    <div class=\"flex justify-center items-center min-h-[400px]\">\n      <div class=\"loading loading-spinner loading-lg text-primary\"></div>\n    </div>\n  {:else if error}\n    <div class=\"alert alert-error\">\n      <span>{error}</span>\n    </div>\n  {:else if channels.length === 0}\n    <div class=\"card bg-base-200\">\n      <div class=\"card-body items-center text-center\">\n        <p class=\"text-base-content/70\">No channels found. Create one to get started!</p>\n      </div>\n    </div>\n  {:else}\n    <div class=\"grid gap-4 sm:grid-cols-2\">\n      {#each channels as channel (channel.id)}\n        <button\n          class=\"card bg-base-200 hover:bg-base-300 transition-base cursor-pointer text-left\"\n          on:click={() => navigateToChannel(channel.id)}\n        >\n          <div class=\"card-body\">\n            <div class=\"flex items-start gap-3\">\n              <div class=\"w-12 h-12 rounded-lg bg-primary flex items-center justify-center text-primary-content font-bold text-xl\">\n                {channel.name.charAt(0).toUpperCase()}\n              </div>\n\n              <div class=\"flex-1 min-w-0\">\n                <h3 class=\"card-title text-lg mb-1\">{channel.name}</h3>\n                {#if channel.description}\n                  <p class=\"text-sm text-base-content/70 line-clamp-2\">\n                    {channel.description}\n                  </p>\n                {/if}\n                <div class=\"flex items-center gap-3 mt-2 text-xs text-base-content/60\">\n                  <span class=\"badge badge-sm badge-ghost\">{channel.visibility}</span>\n                  <span>â€¢</span>\n                  <span>{formatDate(channel.createdAt)}</span>\n                  {#if channel.encrypted}\n                    <span class=\"badge badge-sm badge-primary\">Encrypted</span>\n                  {/if}\n                </div>\n              </div>\n            </div>\n          </div>\n        </button>\n      {/each}\n    </div>\n  {/if}\n</div>\n"],"names":["prerender","load","ctx","get_key","i","insert_hydration","target","div","anchor","div1","append_hydration","span","t_value","p","dirty","set_data","t","t0_value","t2_value","t5_value","formatDate","if_block0","create_if_block_4","if_block1","create_if_block_3","button","div4","div3","div0","div2","h3","span0","span1","span2","t0","t2","t5","t9","t9_value","create_if_block","create_if_block_1","create_if_block_2","timestamp","channels","loading","error","onMount","$authStore","goto","base","setSigner","connectNDK","fetchChannels","e","$$invalidate","navigateToChannel","channelId","channel"],"mappings":"qfAIO,MAAMA,GAAY,GAEZC,GAAiB,UAErB,CAAE,SAAU,EAAC,uNC8DTC,EAAQ,CAAA,CAAA,EAAa,MAAAC,EAAAD,GAAAA,KAAQ,mBAAlC,OAAIE,GAAA,EAAA,6QADRC,EAgCKC,EAAAC,EAAAC,CAAA,sEA/BIN,EAAQ,CAAA,CAAA,ybAPjBG,EAIKC,EAAAG,EAAAD,CAAA,qFAPIN,EAAK,CAAA,CAAA,sFAALA,EAAK,CAAA,CAAA,mFADdG,EAEKC,EAAAC,EAAAC,CAAA,EADHE,EAAmBH,EAAAI,CAAA,0BAAZT,EAAK,CAAA,CAAA,yUALdG,EAEKC,EAAAG,EAAAD,CAAA,2CA4BYI,EAAAV,KAAQ,YAAW,qLADtBG,EAEGC,EAAAO,EAAAL,CAAA,iBADAM,EAAA,GAAAF,KAAAA,EAAAV,KAAQ,YAAW,KAAAa,EAAAC,EAAAJ,CAAA,oQAQpBP,EAA0DC,EAAAK,EAAAH,CAAA,+CAf7DS,EAAAf,KAAQ,KAAK,OAAO,CAAC,EAAE,YAAW,EAAA,WAIEgB,EAAAhB,KAAQ,KAAI,aAOLiB,EAAAjB,KAAQ,WAAU,qBAErDkB,GAAWlB,EAAO,CAAA,EAAC,SAAS,EAAA,aARhCmB,EAAAnB,KAAQ,aAAWoB,GAAApB,CAAA,EASjBqB,EAAArB,KAAQ,WAASsB,GAAA,43CArBhCnB,EA4BQC,EAAAmB,EAAAjB,CAAA,EAxBNE,EAuBKe,EAAAC,CAAA,EAtBHhB,EAqBKgB,EAAAC,CAAA,EApBHjB,EAEKiB,EAAAC,CAAA,gBAELlB,EAeKiB,EAAAE,CAAA,EAdHnB,EAAsDmB,EAAAC,CAAA,sCAMtDpB,EAOKmB,EAAApB,CAAA,EANHC,EAAmED,EAAAsB,CAAA,gBACnErB,EAAaD,EAAAuB,CAAA,SACbtB,EAA2CD,EAAAwB,CAAA,+EAb5CnB,EAAA,GAAAG,KAAAA,EAAAf,KAAQ,KAAK,OAAO,CAAC,EAAE,cAAW,KAAAa,EAAAmB,EAAAjB,CAAA,EAIEH,EAAA,GAAAI,KAAAA,EAAAhB,KAAQ,KAAI,KAAAa,EAAAoB,EAAAjB,CAAA,EAC5ChB,KAAQ,mEAM+BY,EAAA,GAAAK,KAAAA,EAAAjB,KAAQ,WAAU,KAAAa,EAAAqB,EAAAjB,CAAA,cAErDC,GAAWlB,EAAO,CAAA,EAAC,SAAS,EAAA,KAAAa,EAAAsB,EAAAC,CAAA,EAC9BpC,KAAQ,sSAtCxBA,EAAO,CAAA,EAAAqC,GAIFrC,EAAK,CAAA,EAAAsC,GAILtC,EAAQ,CAAA,EAAC,SAAW,EAACuC,4bAdjCpC,EAuDKC,EAAAG,EAAAD,CAAA,EAtDHE,EAGKD,EAAAmB,CAAA,6IAbIR,GAAWsB,EAAA,YACP,KAAKA,EAAY,GAAI,EAAE,mBAAA,gDAhChC,IAAAC,EAAA,CAAA,EACAC,EAAU,GACVC,EAAuB,KAE3BC,GAAA,SAAA,CACO,GAAA,CAAAC,EAAW,kBAAoBA,EAAW,UAAA,CAC7CC,GAAA,GAAQC,EAAI,GAAA,aAMRF,EAAW,YACbG,GAAUH,EAAW,UAAU,EAI3B,MAAAI,GAAA,MACNR,EAAA,MAAiBS,GAAA,CAAA,CACV,OAAAC,EAAA,CACP,QAAQ,MAAM,2BAA4BA,CAAC,EAC3CC,EAAA,EAAAT,EAAQQ,aAAa,MAAQA,EAAE,QAAU,yBAAA,cAEzCT,EAAU,EAAA,cAILW,EAAkBC,EAAA,CACzBR,GAAA,GAAQC,EAAI,SAASO,CAAS,EAAA,oBAqCRD,EAAkBE,EAAQ,EAAE"}