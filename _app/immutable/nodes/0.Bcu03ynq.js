import{q as Y,s as we,d,i as E,l as a,m as ke,g as M,c as k,e as y,j as P,h as b,k as O,p as be,n as V,u as me,b as h,r as F,C as N,o as T,D as S,f as K,t as R,Z as ye,_ as Ce,$ as Ee,a0 as Ae,a as We,A as z}from"../chunks/D9KvLAFu.js";import{S as Ie,i as Me,a as ee,t as te,e as Pe,g as Be}from"../chunks/Bq9qkgAl.js";import{p as Le}from"../chunks/Dc8jY3-b.js";import{d as xe,w as U,b as I}from"../chunks/D2J3qzGV.js";import{a as Te,i as Ne,b as Se}from"../chunks/Bywki5mg.js";const je=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,De=!0,qe=!1,nt=Object.freeze(Object.defineProperty({__proto__:null,prerender:De,ssr:qe},Symbol.toStringTag,{value:"Module"})),H=U(null),ge=U(!1),Z=U(typeof navigator<"u"?navigator.onLine:!0),X=U(null),J=U(!1),se=U(0);function ze(){typeof window>"u"||(window.addEventListener("online",()=>{Z.set(!0),_e()}),window.addEventListener("offline",()=>{Z.set(!1)}),window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),H.set(n)}),window.addEventListener("appinstalled",()=>{J.set(!0),H.set(null)}),window.matchMedia("(display-mode: standalone)").matches&&J.set(!0),navigator.serviceWorker?.addEventListener("message",n=>{const{type:e,count:t}=n.data;e==="SYNC_COMPLETE"&&(console.log(`[PWA] Background sync completed: ${t} messages`),se.set(0))}))}async function Ue(){const n=Y(H);if(!n)return console.warn("[PWA] Install prompt not available"),!1;try{await n.prompt();const{outcome:e}=await n.userChoice;return e==="accepted"?(J.set(!0),H.set(null),!0):!1}catch(e){return console.error("[PWA] Install prompt failed:",e),!1}}async function Oe(){if(typeof navigator>"u"||!("serviceWorker"in navigator))return console.warn("[PWA] Service workers not supported"),null;try{const n=`${I}/service-worker.js`,e=`${I}/`,t=await navigator.serviceWorker.register(n,{scope:e});return console.log("[PWA] Service worker registered:",t),X.set(t),t.addEventListener("updatefound",()=>{const s=t.installing;s&&s.addEventListener("statechange",()=>{s.state==="installed"&&navigator.serviceWorker.controller&&ge.set(!0)})}),t}catch(n){return console.error("[PWA] Service worker registration failed:",n),null}}async function Ve(){const n=Y(X);if(!n?.waiting){console.warn("[PWA] No waiting service worker");return}n.waiting.postMessage({type:"SKIP_WAITING"}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()})}async function Fe(){const n=Y(X);return n?.active?new Promise((e,t)=>{const s=new MessageChannel;s.port1.onmessage=l=>{l.data.messages?(se.set(l.data.messages.length),e(l.data.messages)):t(new Error(l.data.error))},n.active.postMessage({type:"GET_QUEUE"},[s.port2])}):[]}async function _e(){const n=Y(X);if(!n||!("sync"in n)){console.warn("[PWA] Background sync not supported");return}try{await n.sync.register("sync-messages"),console.log("[PWA] Background sync registered")}catch(e){console.error("[PWA] Background sync failed:",e)}}const He=xe([H,J],([n,e])=>n!==null&&!e);async function Ye(){if(typeof window>"u")return;if(ze(),await Oe()){console.log("[PWA] Service worker registered successfully");try{const e=await Fe();e.length>0&&(console.log(`[PWA] Found ${e.length} queued messages`),Y(Z)&&await _e())}catch(e){console.error("[PWA] Failed to check message queue:",e)}}}const{document:ue}=je;function ce(n){let e,t,s,l,r,o="Install Fairfield Nostr for offline access",i,c,f,m="Install",p,v,_="Dismiss",A,u;return{c(){e=b("div"),t=S("svg"),s=S("path"),l=P(),r=b("span"),r.textContent=o,i=P(),c=b("div"),f=b("button"),f.textContent=m,p=P(),v=b("button"),v.textContent=_,this.h()},l(g){e=k(g,"DIV",{class:!0});var w=y(e);t=N(w,"svg",{xmlns:!0,fill:!0,viewBox:!0,class:!0});var D=y(t);s=N(D,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),y(s).forEach(d),D.forEach(d),l=M(w),r=k(w,"SPAN",{"data-svelte-h":!0}),T(r)!=="svelte-wmxgol"&&(r.textContent=o),i=M(w),c=k(w,"DIV",{class:!0});var B=y(c);f=k(B,"BUTTON",{class:!0,"data-svelte-h":!0}),T(f)!=="svelte-1tlyd0p"&&(f.textContent=m),p=M(B),v=k(B,"BUTTON",{class:!0,"data-svelte-h":!0}),T(v)!=="svelte-1qyf3o7"&&(v.textContent=_),B.forEach(d),w.forEach(d),this.h()},h(){a(s,"stroke-linecap","round"),a(s,"stroke-linejoin","round"),a(s,"stroke-width","2"),a(s,"d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"),a(t,"xmlns","http://www.w3.org/2000/svg"),a(t,"fill","none"),a(t,"viewBox","0 0 24 24"),a(t,"class","stroke-current shrink-0 w-6 h-6"),a(f,"class","btn btn-sm btn-primary"),a(v,"class","btn btn-sm btn-ghost"),a(c,"class","flex gap-2"),a(e,"class","alert alert-info fixed top-0 left-0 right-0 z-50 rounded-none")},m(g,w){E(g,e,w),h(e,t),h(t,s),h(e,l),h(e,r),h(e,i),h(e,c),h(c,f),h(c,p),h(c,v),A||(u=[F(f,"click",n[12]),F(v,"click",n[11])],A=!0)},p:V,d(g){g&&d(e),A=!1,me(u)}}}function fe(n){let e,t,s,l,r,o="A new version is available",i,c,f="Update Now",m,p;return{c(){e=b("div"),t=S("svg"),s=S("path"),l=P(),r=b("span"),r.textContent=o,i=P(),c=b("button"),c.textContent=f,this.h()},l(v){e=k(v,"DIV",{class:!0});var _=y(e);t=N(_,"svg",{xmlns:!0,fill:!0,viewBox:!0,class:!0});var A=y(t);s=N(A,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),y(s).forEach(d),A.forEach(d),l=M(_),r=k(_,"SPAN",{"data-svelte-h":!0}),T(r)!=="svelte-1sypjsy"&&(r.textContent=o),i=M(_),c=k(_,"BUTTON",{class:!0,"data-svelte-h":!0}),T(c)!=="svelte-1vor793"&&(c.textContent=f),_.forEach(d),this.h()},h(){a(s,"stroke-linecap","round"),a(s,"stroke-linejoin","round"),a(s,"stroke-width","2"),a(s,"d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"),a(t,"xmlns","http://www.w3.org/2000/svg"),a(t,"fill","none"),a(t,"viewBox","0 0 24 24"),a(t,"class","stroke-current shrink-0 w-6 h-6"),a(c,"class","btn btn-sm btn-warning"),a(e,"class","alert alert-warning fixed top-0 left-0 right-0 z-50 rounded-none")},m(v,_){E(v,e,_),h(e,t),h(t,s),h(e,l),h(e,r),h(e,i),h(e,c),m||(p=F(c,"click",n[13]),m=!0)},p:V,d(v){v&&d(e),m=!1,p()}}}function de(n){let e,t,s,l,r,o,i=n[7]>0&&he(n);return{c(){e=b("div"),t=S("svg"),s=S("path"),l=P(),r=b("span"),o=R(`You're offline. Messages will be queued.
			`),i&&i.c(),this.h()},l(c){e=k(c,"DIV",{class:!0});var f=y(e);t=N(f,"svg",{xmlns:!0,fill:!0,viewBox:!0,class:!0});var m=y(t);s=N(m,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),y(s).forEach(d),m.forEach(d),l=M(f),r=k(f,"SPAN",{});var p=y(r);o=K(p,`You're offline. Messages will be queued.
			`),i&&i.l(p),p.forEach(d),f.forEach(d),this.h()},h(){a(s,"stroke-linecap","round"),a(s,"stroke-linejoin","round"),a(s,"stroke-width","2"),a(s,"d","M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"),a(t,"xmlns","http://www.w3.org/2000/svg"),a(t,"fill","none"),a(t,"viewBox","0 0 24 24"),a(t,"class","stroke-current shrink-0 w-6 h-6"),a(e,"class","alert alert-error fixed bottom-0 left-0 right-0 z-50 rounded-none")},m(c,f){E(c,e,f),h(e,t),h(t,s),h(e,l),h(e,r),h(r,o),i&&i.m(r,null)},p(c,f){c[7]>0?i?i.p(c,f):(i=he(c),i.c(),i.m(r,null)):i&&(i.d(1),i=null)},d(c){c&&d(e),i&&i.d()}}}function he(n){let e,t,s;return{c(){e=R("("),t=R(n[7]),s=R(" queued)")},l(l){e=K(l,"("),t=K(l,n[7]),s=K(l," queued)")},m(l,r){E(l,e,r),E(l,t,r),E(l,s,r)},p(l,r){r&128&&We(t,l[7])},d(l){l&&(d(e),d(t),d(s))}}}function Ge(n){let e,t='<div class="loading loading-spinner loading-lg text-primary"></div>';return{c(){e=b("div"),e.innerHTML=t,this.h()},l(s){e=k(s,"DIV",{class:!0,"data-svelte-h":!0}),T(e)!=="svelte-1ogc7xv"&&(e.innerHTML=t),this.h()},h(){a(e,"class","flex items-center justify-center min-h-screen")},m(s,l){E(s,e,l)},p:V,i:V,o:V,d(s){s&&d(e)}}}function Qe(n){let e,t,s=n[5]&&n[8]&&pe(n);const l=n[15].default,r=ye(l,n,n[14],null);return{c(){s&&s.c(),e=P(),r&&r.c()},l(o){s&&s.l(o),e=M(o),r&&r.l(o)},m(o,i){s&&s.m(o,i),E(o,e,i),r&&r.m(o,i),t=!0},p(o,i){o[5]&&o[8]?s?s.p(o,i):(s=pe(o),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null),r&&r.p&&(!t||i&16384)&&Ce(r,l,o,o[14],t?Ae(l,o[14],i,null):Ee(o[14]),null)},i(o){t||(te(r,o),t=!0)},o(o){ee(r,o),t=!1},d(o){o&&d(e),s&&s.d(o),r&&r.d(o)}}}function pe(n){let e,t,s=`<a href="${I}/chat" class="btn btn-ghost text-xl">Fairfield Nostr</a>`,l,r,o,i,c,f="Channels",m,p,v,_="Messages",A,u,g,w,D,B,C="Logout",$,ne,W=n[9]&&ve(n);function le(L,x){return L[2]==="dark"?Re:Ke}let G=le(n),j=G(n);return{c(){e=b("nav"),t=b("div"),t.innerHTML=s,l=P(),r=b("div"),o=b("ul"),i=b("li"),c=b("a"),c.textContent=f,m=P(),p=b("li"),v=b("a"),v.textContent=_,A=P(),W&&W.c(),u=P(),g=b("div"),w=b("button"),j.c(),D=P(),B=b("button"),B.textContent=C,this.h()},l(L){e=k(L,"NAV",{class:!0});var x=y(e);t=k(x,"DIV",{class:!0,"data-svelte-h":!0}),T(t)!=="svelte-1te70lp"&&(t.innerHTML=s),l=M(x),r=k(x,"DIV",{class:!0});var re=y(r);o=k(re,"UL",{class:!0});var q=y(o);i=k(q,"LI",{});var oe=y(i);c=k(oe,"A",{href:!0,"data-svelte-h":!0}),T(c)!=="svelte-1jb66cd"&&(c.textContent=f),oe.forEach(d),m=M(q),p=k(q,"LI",{});var ae=y(p);v=k(ae,"A",{href:!0,"data-svelte-h":!0}),T(v)!=="svelte-cztui3"&&(v.textContent=_),ae.forEach(d),A=M(q),W&&W.l(q),q.forEach(d),re.forEach(d),u=M(x),g=k(x,"DIV",{class:!0});var Q=y(g);w=k(Q,"BUTTON",{class:!0});var ie=y(w);j.l(ie),ie.forEach(d),D=M(Q),B=k(Q,"BUTTON",{class:!0,"data-svelte-h":!0}),T(B)!=="svelte-1ppmxs8"&&(B.textContent=C),Q.forEach(d),x.forEach(d),this.h()},h(){a(t,"class","navbar-start"),a(c,"href",I+"/chat"),z(c,"active",n[0].url.pathname.startsWith(`${I}/chat`)),a(v,"href",I+"/dm"),z(v,"active",n[0].url.pathname.startsWith(`${I}/dm`)),a(o,"class","menu menu-horizontal px-1"),a(r,"class","navbar-center hidden lg:flex"),a(w,"class","btn btn-ghost btn-circle"),a(B,"class","btn btn-ghost"),a(g,"class","navbar-end gap-2"),a(e,"class","navbar bg-base-200 shadow-lg")},m(L,x){E(L,e,x),h(e,t),h(e,l),h(e,r),h(r,o),h(o,i),h(i,c),h(o,m),h(o,p),h(p,v),h(o,A),W&&W.m(o,null),h(e,u),h(e,g),h(g,w),j.m(w,null),h(g,D),h(g,B),$||(ne=[F(w,"click",n[10]),F(B,"click",n[16])],$=!0)},p(L,x){x&1&&z(c,"active",L[0].url.pathname.startsWith(`${I}/chat`)),x&1&&z(v,"active",L[0].url.pathname.startsWith(`${I}/dm`)),L[9]?W?W.p(L,x):(W=ve(L),W.c(),W.m(o,null)):W&&(W.d(1),W=null),G!==(G=le(L))&&(j.d(1),j=G(L),j&&(j.c(),j.m(w,null)))},d(L){L&&d(e),W&&W.d(),j.d(),$=!1,me(ne)}}}function ve(n){let e,t,s="Admin";return{c(){e=b("li"),t=b("a"),t.textContent=s,this.h()},l(l){e=k(l,"LI",{});var r=y(e);t=k(r,"A",{href:!0,"data-svelte-h":!0}),T(t)!=="svelte-dtigh"&&(t.textContent=s),r.forEach(d),this.h()},h(){a(t,"href",I+"/admin"),z(t,"active",n[0].url.pathname===`${I}/admin`)},m(l,r){E(l,e,r),h(e,t)},p(l,r){r&1&&z(t,"active",l[0].url.pathname===`${I}/admin`)},d(l){l&&d(e)}}}function Ke(n){let e,t;return{c(){e=S("svg"),t=S("path"),this.h()},l(s){e=N(s,"svg",{xmlns:!0,fill:!0,viewBox:!0,class:!0});var l=y(e);t=N(l,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),y(t).forEach(d),l.forEach(d),this.h()},h(){a(t,"stroke","currentColor"),a(t,"stroke-linecap","round"),a(t,"stroke-linejoin","round"),a(t,"stroke-width","2"),a(t,"d","M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"),a(e,"xmlns","http://www.w3.org/2000/svg"),a(e,"fill","none"),a(e,"viewBox","0 0 24 24"),a(e,"class","w-5 h-5")},m(s,l){E(s,e,l),h(e,t)},d(s){s&&d(e)}}}function Re(n){let e,t;return{c(){e=S("svg"),t=S("path"),this.h()},l(s){e=N(s,"svg",{xmlns:!0,fill:!0,viewBox:!0,class:!0});var l=y(e);t=N(l,"path",{stroke:!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),y(t).forEach(d),l.forEach(d),this.h()},h(){a(t,"stroke","currentColor"),a(t,"stroke-linecap","round"),a(t,"stroke-linejoin","round"),a(t,"stroke-width","2"),a(t,"d","M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"),a(e,"xmlns","http://www.w3.org/2000/svg"),a(e,"fill","none"),a(e,"viewBox","0 0 24 24"),a(e,"class","w-5 h-5")},m(s,l){E(s,e,l),h(e,t)},d(s){s&&d(e)}}}function Ze(n){let e,t,s,l,r,o,i,c,f=n[3]&&ce(n),m=n[4]&&fe(n),p=!n[6]&&de(n);const v=[Qe,Ge],_=[];function A(u,g){return u[1]?0:1}return o=A(n),i=_[o]=v[o](n),{c(){e=P(),f&&f.c(),t=P(),m&&m.c(),s=P(),p&&p.c(),l=P(),r=b("div"),i.c(),this.h()},l(u){ke("svelte-jwdgo",ue.head).forEach(d),e=M(u),f&&f.l(u),t=M(u),m&&m.l(u),s=M(u),p&&p.l(u),l=M(u),r=k(u,"DIV",{class:!0});var w=y(r);i.l(w),w.forEach(d),this.h()},h(){ue.title="Fairfield Nostr",a(r,"class","min-h-screen w-full transition-base")},m(u,g){E(u,e,g),f&&f.m(u,g),E(u,t,g),m&&m.m(u,g),E(u,s,g),p&&p.m(u,g),E(u,l,g),E(u,r,g),_[o].m(r,null),c=!0},p(u,[g]){u[3]?f?f.p(u,g):(f=ce(u),f.c(),f.m(t.parentNode,t)):f&&(f.d(1),f=null),u[4]?m?m.p(u,g):(m=fe(u),m.c(),m.m(s.parentNode,s)):m&&(m.d(1),m=null),u[6]?p&&(p.d(1),p=null):p?p.p(u,g):(p=de(u),p.c(),p.m(l.parentNode,l));let w=o;o=A(u),o===w?_[o].p(u,g):(Be(),ee(_[w],1,1,()=>{_[w]=null}),Pe(),i=_[o],i?i.p(u,g):(i=_[o]=v[o](u),i.c()),te(i,1),i.m(r,null))},i(u){c||(te(i),c=!0)},o(u){ee(i),c=!1},d(u){u&&(d(e),d(t),d(s),d(l),d(r)),f&&f.d(u),m&&m.d(u),p&&p.d(u),_[o].d()}}}function Je(n,e,t){let s,l,r,o,i,c;O(n,Le,C=>t(0,l=C)),O(n,Z,C=>t(6,r=C)),O(n,se,C=>t(7,o=C)),O(n,Ne,C=>t(8,i=C)),O(n,Se,C=>t(9,c=C));let{$$slots:f={},$$scope:m}=e,p=!1,v="dark",_=!1,A=!1;He.subscribe(C=>{t(3,_=C)}),ge.subscribe(C=>{t(4,A=C)}),be(()=>{t(1,p=!0);{const C=localStorage.getItem("theme")||"dark";t(2,v=C),document.documentElement.setAttribute("data-theme",C),Ye()}});function u(){t(2,v=v==="dark"?"light":"dark"),document.documentElement.setAttribute("data-theme",v),localStorage.setItem("theme",v)}function g(){t(3,_=!1)}async function w(){await Ue()&&t(3,_=!1)}async function D(){await Ve()}const B=()=>Te.logout();return n.$$set=C=>{"$$scope"in C&&t(14,m=C.$$scope)},n.$$.update=()=>{n.$$.dirty&1&&t(5,s=l.url.pathname!==`${I}/`&&l.url.pathname!==I&&l.url.pathname!==`${I}/signup`&&l.url.pathname!==`${I}/setup`)},[l,p,v,_,A,s,r,o,i,c,u,g,w,D,m,f,B]}class lt extends Ie{constructor(e){super(),Me(this,e,Je,Ze,we,{})}}export{lt as component,nt as universal};
//# sourceMappingURL=0.Bcu03ynq.js.map
