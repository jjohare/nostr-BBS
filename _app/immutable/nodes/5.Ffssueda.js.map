{"version":3,"file":"5.Ffssueda.js","sources":["../../../../../../src/routes/chat/[channelId]/+page.ts","../../../../../../src/routes/chat/[channelId]/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\nimport { browser } from '$app/environment';\nimport { ndkStore, fetchChannels, fetchChannelMessages } from '$lib/stores/ndk';\n\n// Dynamic routes can't be prerendered\nexport const prerender = false;\n\nexport const load: PageLoad = async ({ params }) => {\n  if (!browser) {\n    return { channel: null, messages: [] };\n  }\n\n  const stored = localStorage.getItem('fairfield_auth');\n  if (!stored) {\n    // Auth check handled in component\n    return { channel: null, messages: [] };\n  }\n\n  try {\n    const ndk = ndkStore.get();\n    if (!ndk) {\n      return { channel: null, messages: [] };\n    }\n\n    const channels = await fetchChannels(ndk);\n    const channel = channels.find(c => c.id === params.channelId);\n\n    if (!channel) {\n      return { channel: null, messages: [] };\n    }\n\n    const messages = await fetchChannelMessages(ndk, params.channelId);\n\n    return { channel, messages };\n  } catch (error) {\n    console.error('Failed to load channel:', error);\n    return { channel: null, messages: [] };\n  }\n};\n","<script lang=\"ts\">\n  import { onMount, onDestroy } from 'svelte';\n  import { goto } from '$app/navigation';\n  import { page } from '$app/stores';\n  import { base } from '$app/paths';\n  import { channelStore } from '$lib/stores/channels';\n  import { authStore } from '$lib/stores/auth';\n  import { ndk } from '$lib/nostr/ndk';\n  import type { Channel } from '$lib/stores/channels';\n\n  $: channelId = $page.params.channelId;\n\n  let channel: Channel | null = null;\n  let messages: any[] = [];\n  let messageInput = '';\n  let loading = true;\n  let sending = false;\n  let messagesContainer: HTMLDivElement;\n\n  onMount(async () => {\n    if (!$authStore.isAuthenticated) {\n      goto(`${base}/`);\n      return;\n    }\n\n    try {\n      const ndkInstance = await ndk.getNDK();\n      const channels = await channelStore.fetchChannels(\n        ndkInstance,\n        $authStore.publicKey!,\n        ['business', 'moomaa-tribe']\n      );\n      channel = channels.find(c => c.id === channelId) || null;\n\n      if (!channel) {\n        goto(`${base}/chat`);\n        return;\n      }\n\n      // Load messages (placeholder - implement with actual Nostr events)\n      messages = [];\n    } catch (error) {\n      console.error('Error loading channel:', error);\n    } finally {\n      loading = false;\n    }\n  });\n\n  async function sendMessage() {\n    if (!messageInput.trim() || sending || !channel) return;\n\n    sending = true;\n    const content = messageInput;\n    messageInput = '';\n\n    try {\n      // Implement actual message sending via NDK\n      console.log('Sending message:', content);\n    } catch (error) {\n      console.error('Error sending message:', error);\n      messageInput = content;\n    } finally {\n      sending = false;\n    }\n  }\n\n  function formatTime(timestamp: number): string {\n    return new Date(timestamp * 1000).toLocaleTimeString([], {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  }\n</script>\n\n<svelte:head>\n  <title>{channel?.name || 'Channel'} - Fairfield Nostr</title>\n</svelte:head>\n\n{#if loading}\n  <div class=\"flex justify-center items-center h-[calc(100vh-64px)]\">\n    <div class=\"loading loading-spinner loading-lg text-primary\"></div>\n  </div>\n{:else if channel}\n  <div class=\"flex flex-col h-[calc(100vh-64px)]\">\n    <div class=\"bg-base-200 border-b border-base-300 p-4\">\n      <div class=\"container mx-auto max-w-4xl\">\n        <button class=\"btn btn-ghost btn-sm mb-2\" on:click={() => goto(`${base}/chat`)}>\n          ‚Üê Back to Channels\n        </button>\n        <h1 class=\"text-2xl font-bold\">{channel.name}</h1>\n        {#if channel.description}\n          <p class=\"text-base-content/70 text-sm\">{channel.description}</p>\n        {/if}\n      </div>\n    </div>\n\n    <div class=\"flex-1 overflow-y-auto p-4 bg-base-100\" bind:this={messagesContainer}>\n      <div class=\"container mx-auto max-w-4xl\">\n        {#if messages.length === 0}\n          <div class=\"flex items-center justify-center h-full text-base-content/50\">\n            <p>No messages yet. Start the conversation!</p>\n          </div>\n        {:else}\n          <div class=\"space-y-4\">\n            {#each messages as message (message.id)}\n              <div class=\"chat chat-start\">\n                <div class=\"chat-bubble\">{message.content}</div>\n                <div class=\"chat-footer opacity-50 text-xs\">\n                  {formatTime(message.created_at)}\n                </div>\n              </div>\n            {/each}\n          </div>\n        {/if}\n      </div>\n    </div>\n\n    <div class=\"bg-base-200 border-t border-base-300 p-4\">\n      <div class=\"container mx-auto max-w-4xl\">\n        <form on:submit|preventDefault={sendMessage} class=\"flex gap-2\">\n          <input\n            type=\"text\"\n            class=\"input input-bordered flex-1\"\n            placeholder=\"Type a message...\"\n            bind:value={messageInput}\n            disabled={sending}\n          />\n          <button\n            type=\"submit\"\n            class=\"btn btn-primary\"\n            disabled={sending || !messageInput.trim()}\n          >\n            {sending ? 'Sending...' : 'Send'}\n          </button>\n        </form>\n      </div>\n    </div>\n  </div>\n{/if}\n"],"names":["prerender","load","params","ndk","ndkStore","channel","fetchChannels","c","messages","fetchChannelMessages","error","t2_value","ctx","if_block0","create_if_block_3","create_if_block_2","insert_hydration","target","div6","anchor","append_hydration","div1","div0","button0","h1","div3","div2","div5","div4","form","input","button1","dirty","set_data","t2","t7","t7_value","t_value","p","t","get_key","i","div","t0_value","formatTime","t0","create_if_block","create_if_block_1","timestamp","messageInput","loading","sending","messagesContainer","onMount","$authStore","goto","base","ndkInstance","channels","channelStore","$$invalidate","channelId","sendMessage","content","click_handler","$$value","$page"],"mappings":"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"}