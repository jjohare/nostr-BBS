{"version":3,"mappings":";kFAiBA,MAAMA,EAA0B,CAC9B,gBAAiB,GACjB,UAAW,KACX,WAAY,KACZ,SAAU,KACV,SAAU,KACV,OAAQ,KACR,UAAW,GACX,QAAS,GACT,MAAO,IACT,EAGMC,EAAe,mEACfC,EAA+B,CAACD,CAAY,EAElD,SAASE,GAAkB,CACzB,KAAM,CAAE,UAAAC,EAAW,IAAAC,EAAK,OAAAC,CAAA,EAAgCC,EAASP,CAAY,EAEhE,CACX,MAAMQ,EAAS,aAAa,QAAQ,gBAAgB,EACpD,GAAIA,EACF,GAAI,CACF,MAAMC,EAAS,KAAK,MAAMD,CAAM,EAChCF,EAAOI,IAAU,CACf,GAAGA,EACH,GAAGD,EACH,gBAAiB,GACjB,QAASP,EAAc,SAASO,EAAO,WAAa,EAAE,GACtD,CACJ,MAAY,CACV,aAAa,WAAW,gBAAgB,CAC1C,CAEJ,CAEA,MAAO,CACL,UAAAL,EACA,QAAS,CAACO,EAAmBC,EAAoBC,IAAsB,CACrE,MAAMC,EAAW,CACf,UAAAH,EACA,WAAAC,EACA,SAAUC,GAAY,KACtB,gBAAiB,GACjB,QAASX,EAAc,SAASS,CAAS,EACzC,UAAW,GACX,MAAO,MAGI,CAEX,MAAMI,EAAW,aAAa,QAAQ,gBAAgB,EACtD,IAAIC,EAAuD,GAC3D,GAAID,EACF,GAAI,CAAEC,EAAe,KAAK,MAAMD,CAAQ,CAAG,MAAQ,CAAC,CAEtD,aAAa,QAAQ,iBAAkB,KAAK,UAAU,CACpD,UAAAJ,EACA,WAAAC,EACA,SAAUC,GAAY,KACtB,SAAUG,EAAa,UAAY,KACnC,OAAQA,EAAa,QAAU,KAChC,CAAC,CACJ,CAEAV,MAAiB,CAAE,GAAGI,EAAO,GAAGI,GAAW,CAC7C,EACA,WAAY,CAACG,EAAyBC,IAA0B,CACjD,CACX,MAAMV,EAAS,aAAa,QAAQ,gBAAgB,EACpD,GAAIA,EAAQ,CACV,MAAMW,EAAO,KAAK,MAAMX,CAAM,EAC9BW,EAAK,SAAWF,EAChBE,EAAK,OAASD,EACd,aAAa,QAAQ,iBAAkB,KAAK,UAAUC,CAAI,CAAC,CAC7D,CACF,CACAb,MAAiB,CAAE,GAAGI,EAAO,SAAAO,EAAU,OAAAC,GAAS,CAClD,EACA,WAAaE,GAAuB,CAClCd,EAAOI,IAAU,CAAE,GAAGA,EAAO,UAAAU,GAAY,CAC3C,EACA,SAAWC,GAAkB,CAC3Bf,EAAOI,IAAU,CAAE,GAAGA,EAAO,MAAAW,GAAQ,CACvC,EACA,WAAY,IAAM,CAChBf,MAAiB,CAAE,GAAGI,EAAO,MAAO,MAAO,CAC7C,EACA,OAAQ,SAAY,CAClBL,EAAIL,CAAY,EACH,CACX,aAAa,WAAW,gBAAgB,EACxC,KAAM,CAAE,KAAAsB,CAAA,EAAS,MAAAC,EAAA,qBAAAD,CAAA,OAAM,QAAO,eAAiB,OAAAE,KAAA,eAAAF,CAAA,6CAC/CA,EAAK,GAAGG,CAAI,GAAG,CACjB,CACF,EACA,MAAO,IAAMpB,EAAIL,CAAY,EAEjC,CAEO,MAAM0B,EAAYvB,EAAA,EACZwB,EAAkBC,EAAQF,EAAWG,GAASA,EAAM,eAAe,EACnEC,EAAUF,EAAQF,EAAWG,GAASA,EAAM,OAAO","names":["initialState","ADMIN_PUBKEY","ADMIN_PUBKEYS","createAuthStore","subscribe","set","update","writable","stored","parsed","state","publicKey","privateKey","mnemonic","authData","existing","existingData","nickname","avatar","data","isPending","error","goto","__vitePreload","n","base","authStore","isAuthenticated","derived","$auth","isAdmin"],"ignoreList":[],"sources":["../../../../../../src/lib/stores/auth.ts"],"sourcesContent":["import { writable, derived } from 'svelte/store';\nimport type { Writable } from 'svelte/store';\nimport { browser } from '$app/environment';\nimport { base } from '$app/paths';\n\nexport interface AuthState {\n  isAuthenticated: boolean;\n  publicKey: string | null;\n  privateKey: string | null;\n  mnemonic: string | null;\n  nickname: string | null;\n  avatar: string | null;\n  isPending: boolean;\n  isAdmin: boolean;\n  error: string | null;\n}\n\nconst initialState: AuthState = {\n  isAuthenticated: false,\n  publicKey: null,\n  privateKey: null,\n  mnemonic: null,\n  nickname: null,\n  avatar: null,\n  isPending: false,\n  isAdmin: false,\n  error: null\n};\n\n// Admin pubkey from environment config (hex format)\nconst ADMIN_PUBKEY = import.meta.env.VITE_ADMIN_PUBKEY || '';\nconst ADMIN_PUBKEYS = ADMIN_PUBKEY ? [ADMIN_PUBKEY] : [];\n\nfunction createAuthStore() {\n  const { subscribe, set, update }: Writable<AuthState> = writable(initialState);\n\n  if (browser) {\n    const stored = localStorage.getItem('fairfield_keys');\n    if (stored) {\n      try {\n        const parsed = JSON.parse(stored);\n        update(state => ({\n          ...state,\n          ...parsed,\n          isAuthenticated: true,\n          isAdmin: ADMIN_PUBKEYS.includes(parsed.publicKey || '')\n        }));\n      } catch (e) {\n        localStorage.removeItem('fairfield_keys');\n      }\n    }\n  }\n\n  return {\n    subscribe,\n    setKeys: (publicKey: string, privateKey: string, mnemonic?: string) => {\n      const authData = {\n        publicKey,\n        privateKey,\n        mnemonic: mnemonic || null,\n        isAuthenticated: true,\n        isAdmin: ADMIN_PUBKEYS.includes(publicKey),\n        isPending: false,\n        error: null\n      };\n\n      if (browser) {\n        // Preserve existing nickname/avatar if present\n        const existing = localStorage.getItem('fairfield_keys');\n        let existingData: { nickname?: string; avatar?: string } = {};\n        if (existing) {\n          try { existingData = JSON.parse(existing); } catch {}\n        }\n        localStorage.setItem('fairfield_keys', JSON.stringify({\n          publicKey,\n          privateKey,\n          mnemonic: mnemonic || null,\n          nickname: existingData.nickname || null,\n          avatar: existingData.avatar || null\n        }));\n      }\n\n      update(state => ({ ...state, ...authData }));\n    },\n    setProfile: (nickname: string | null, avatar: string | null) => {\n      if (browser) {\n        const stored = localStorage.getItem('fairfield_keys');\n        if (stored) {\n          const data = JSON.parse(stored);\n          data.nickname = nickname;\n          data.avatar = avatar;\n          localStorage.setItem('fairfield_keys', JSON.stringify(data));\n        }\n      }\n      update(state => ({ ...state, nickname, avatar }));\n    },\n    setPending: (isPending: boolean) => {\n      update(state => ({ ...state, isPending }));\n    },\n    setError: (error: string) => {\n      update(state => ({ ...state, error }));\n    },\n    clearError: () => {\n      update(state => ({ ...state, error: null }));\n    },\n    logout: async () => {\n      set(initialState);\n      if (browser) {\n        localStorage.removeItem('fairfield_keys');\n        const { goto } = await import('$app/navigation');\n        goto(`${base}/`);\n      }\n    },\n    reset: () => set(initialState)\n  };\n}\n\nexport const authStore = createAuthStore();\nexport const isAuthenticated = derived(authStore, $auth => $auth.isAuthenticated);\nexport const isAdmin = derived(authStore, $auth => $auth.isAdmin);\n"],"file":"_app/immutable/chunks/szLgq1wZ.js"}